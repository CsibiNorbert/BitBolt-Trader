<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView Chart Test</title>
    <style>
        body {
            background-color: #1e1e1e;
            color: white;
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #test-chart {
            width: 800px;
            height: 400px;
            background: #1e1e1e;
            border: 1px solid #333;
            margin: 20px 0;
        }
        .log {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>TradingView Chart Test</h1>
    <p>This page tests if the TradingView JavaScript implementation works correctly.</p>
    
    <div id="test-chart"></div>
    
    <button onclick="initializeChart()">Initialize Chart</button>
    <button onclick="clearLog()">Clear Log</button>
    
    <h3>Console Log:</h3>
    <div id="log" class="log"></div>

    <!-- TradingView Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <!-- Our TradingView Implementation -->
    <script src="js/tradingview-simple.js"></script>
    
    <script>
        // Override console.log to show in page
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function logToPage(message, type = 'log') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'warn' ? '#feca57' : '#48dbfb';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToPage(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToPage(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToPage(args.join(' '), 'warn');
        };
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        async function initializeChart() {
            try {
                console.log('Starting chart initialization...');
                
                // Check if TradingView library is loaded
                if (typeof LightweightCharts === 'undefined') {
                    console.error('LightweightCharts library not loaded!');
                    return;
                }
                console.log('LightweightCharts library loaded successfully');
                
                // Check if our TradingViewChart object exists
                if (typeof TradingViewChart === 'undefined') {
                    console.error('TradingViewChart object not found!');
                    return;
                }
                console.log('TradingViewChart object found');
                
                const chartId = 'test-chart';
                
                // Step 1: Create chart
                console.log('Creating chart...');
                const createSuccess = await TradingViewChart.createChart(chartId);
                if (!createSuccess) {
                    console.error('Failed to create chart');
                    return;
                }
                console.log('Chart created successfully');
                
                // Step 2: Add series
                console.log('Adding candlestick series...');
                const candleSuccess = TradingViewChart.addCandlestickSeries(chartId);
                if (!candleSuccess) {
                    console.error('Failed to add candlestick series');
                    return;
                }
                
                console.log('Adding volume series...');
                const volumeSuccess = TradingViewChart.addVolumeSeries(chartId);
                if (!volumeSuccess) {
                    console.error('Failed to add volume series');
                    return;
                }
                
                // Step 3: Generate sample data
                console.log('Generating sample data...');
                const candleData = generateSampleCandleData();
                const volumeData = generateSampleVolumeData();
                
                // Step 4: Set data
                console.log('Setting candlestick data...');
                const setCandleSuccess = TradingViewChart.setCandlestickData(chartId, candleData);
                if (!setCandleSuccess) {
                    console.error('Failed to set candlestick data');
                    return;
                }
                
                console.log('Setting volume data...');
                const setVolumeSuccess = TradingViewChart.setVolumeData(chartId, volumeData);
                if (!setVolumeSuccess) {
                    console.error('Failed to set volume data');
                    return;
                }
                
                console.log('Chart initialization completed successfully!');
                
            } catch (error) {
                console.error('Error during chart initialization:', error);
            }
        }
        
        function generateSampleCandleData() {
            const data = [];
            const basePrice = 67000;
            const baseTime = Math.floor(Date.now() / 1000) - (24 * 60 * 60); // 24 hours ago
            
            for (let i = 0; i < 50; i++) {
                const time = baseTime + (i * 15 * 60); // 15-minute intervals
                const open = basePrice + (Math.random() * 1000 - 500);
                const close = open + (Math.random() * 800 - 400);
                const high = Math.max(open, close) + Math.random() * 200;
                const low = Math.min(open, close) - Math.random() * 200;
                
                data.push({
                    time: time,
                    open: Math.round(open * 100) / 100,
                    high: Math.round(high * 100) / 100,
                    low: Math.round(low * 100) / 100,
                    close: Math.round(close * 100) / 100
                });
            }
            
            return data;
        }
        
        function generateSampleVolumeData() {
            const data = [];
            const baseTime = Math.floor(Date.now() / 1000) - (24 * 60 * 60); // 24 hours ago
            
            for (let i = 0; i < 50; i++) {
                const time = baseTime + (i * 15 * 60); // 15-minute intervals
                const volume = Math.random() * 1000 + 100;
                const color = Math.random() > 0.5 ? '#26a69a' : '#ef5350';
                
                data.push({
                    time: time,
                    value: Math.round(volume * 100) / 100,
                    color: color
                });
            }
            
            return data;
        }
        
        // Auto-initialize after page loads
        window.addEventListener('load', function() {
            console.log('Page loaded, waiting 2 seconds before auto-initialization...');
            setTimeout(initializeChart, 2000);
        });
    </script>
</body>
</html> 